!function(e,t){function s(t,s){this.element=t,this.options=e.extend({},p,s),this._defaults=p,this._name=f,this.init()}var n=1,i=16,l=37,o=38,r=39,a=40,c="cell",u="selecTable",h="selected",d="cursored",f="selecTable",p=(t.document,{});s.prototype.clearSelectedCells=function(){e(this.selectedCells).removeClass(h),this.selectedCells=[]},s.prototype.updateSelectedCells=function(){this.clearSelectedCells();var t,s,n,i,l=this.$cellA,o=this.$cellB,r=l.data(c).split(","),a=o.data(c).split(","),u=r[0],d=a[0],f=r[1],p=a[1];u>d?(t=d,s=u):(t=u,s=d),f>p?(n=p,i=f):(n=f,i=p);for(var w=t;s>=w;++w)for(var m=e(this.$rows[w]),v=m.find("td"),C=n;i>=C;++C){var $=v[C];this.selectedCells.push($),e($).addClass(h)}e(this.element).trigger("selectionupdate",[e.extend([],this.selectedCells)])};var w="plugin_"+f,m="table",v=function(t){var s;return e(t).parents(m).each(function(){var t=e(this).data(w);return t?(s=t,!1):void 0}),s};s.prototype.set$cellB=function(e){this.$cellB.removeClass(d),this.$cellB=e,this.$cellB.addClass(d)},s.prototype.mousedown=function(t){if(t.which!==n)return!0;var s=v(this);s.isShiftDown?s.selectedCells=[]:s.$cellA=e(t.target),s.isMouseDown=!0},s.prototype.mouseenter=function(t){var s=this;setTimeout(function(){var n=v(s);return n.isMouseDown?(n.set$cellB(e(t.target)),n.updateSelectedCells(),void 0):!0},0)},s.prototype.mouseup=function(t){if(t.which!==n)return!0;var s=v(this);s.isMouseDown=!1,s.set$cellB(e(t.target)),s.updateSelectedCells()},s.prototype.keydown=function(t){var s,n,u=e(this).data(w),h=t.which,d=u.$cellB,f=d.data(c).split(","),p=parseInt(f[0],10),m=parseInt(f[1],10);if(h===i)u.isShiftDown=!0;else{switch(h){case l:s=p,n=m-1,n=n>=0?n:0;break;case r:s=p,n=m+1,n=n<u.numOfCols?n:u.numOfCols-1;break;case o:s=p-1,s=s>=0?s:0,n=m;break;case a:s=p+1,s=s<u.numOfRows?s:u.numOfRows-1,n=m}var v=e(u.$rows[s]),C=e(v.find("td")[n]);u.isShiftDown||(u.$cellA=C),u.set$cellB(C),u.updateSelectedCells()}},s.prototype.keyup=function(t){var s=e(this).data(w);t.which===i&&(s.isShiftDown=!1)};var C=function(t){var s=e(t).find("tr");s.each(function(t){var s=e(this).find("td");s.each(function(s){e(this).data(c,t+","+s)})})};s.prototype.init=function(){var t=e(this.element),s=t.find("tr"),n=t.find("td");this.numOfRows=s.length,this.numOfCols=e(s[0]).find("td").length,this.$rows=s,C(this.element),this.$cellA=e(),this.$cellB=e(),this.isMouseDown=!1,this.isShiftDown=!1,this.selectedCells=[],n.mousedown(this.mousedown).mouseenter(this.mouseenter).mouseup(this.mouseup),t.keydown(this.keydown).keyup(this.keyup),t.attr("unselectable","on").css({"-moz-user-select":"none","-o-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"}).bind("selectstart",function(){return!1}),t.addClass(u)},e.fn[f]=function(t){return this.each(function(){e.data(this,"plugin_"+f)||e.data(this,"plugin_"+f,new s(this,t))})}}(jQuery,window);