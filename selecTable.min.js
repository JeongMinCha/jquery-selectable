!function(e,t,s){function l(t,s){this.element=t,this.options=e.extend({},v,s),this._defaults=v,this._name=m,this.init()}var n="string",i=1,o=16,a=37,c=38,r=39,u=40,h=[o,a,c,r,u],d="cell",p="selecTable",f="selected",w="cursored",m="selecTable",v=(t.document,{});l.prototype.clearSelectedCells=function(){e(this.selectedCells).removeClass(f),this.selectedCells=[]},l.prototype.updateSelectedCells=function(t){this.clearSelectedCells();var s,l,n,i,o=this.$cellA,a=this.$cellB,c=o.data(d).split(","),r=a.data(d).split(","),u=+c[0],h=+r[0],p=c[1],w=r[1];u>h?(s=h,l=u):(s=u,l=h),p>w?(n=w,i=p):(n=p,i=w);for(var m=[],v=s;l>=v;++v)for(var C=e(this.$rows[v]),g=C.find("td"),y=n;i>=y;++y){var $=g[y];this.selectedCells.push($),m.push({row:v,col:y}),e($).addClass(f)}var b={selectedCells:e.extend([],this.selectedCells),selectedCellsNo:m,lastSelectedCell:a[0]};t&&t.pageX&&t.pageY&&(b.pageX=t.pageX,b.pageY=t.pageY),e(this.element).trigger("selectionupdate",b)};var C="plugin_"+m,g="table",y=function(t){var s;return e(t).parents(g).each(function(){var t=e(this).data(C);return t?(s=t,!1):void 0}),s};l.prototype.set$cellB=function(e){this.$cellB.removeClass(w),this.$cellB=e,this.$cellB.addClass(w)},l.prototype.mousedown=function(t){if(t.which!==i)return!0;var s=y(this);s.isShiftDown?s.selectedCells=[]:s.$cellA=e(t.target),s.isMouseDown=!0},l.prototype.mouseenter=function(t){var s=this;setTimeout(function(){var l=y(s);return l.isMouseDown?(l.set$cellB(e(t.target)),l.updateSelectedCells(),void 0):!0},0)},l.prototype.mouseup=function(t){if(t.which!==i)return!0;var s=y(this);s.isMouseDown=!1,s.set$cellB(e(t.target)),s.updateSelectedCells(t)},l.prototype.keydown=function(t){var s=e(this).data(C),l=t.which,n=!1;if(e.each(h,function(e,t){return l===t?(n=!0,!1):void 0}),!n)return!0;var i,p,f=s.$cellB,w=f.data(d).split(","),m=+w[0],v=+w[1];if(l===o)s.isShiftDown=!0;else{switch(l){case a:i=m,p=v-1,p=p>=0?p:0;break;case r:i=m,p=v+1,p=p<s.numOfCols?p:s.numOfCols-1;break;case c:i=m-1,i=i>=0?i:0,p=v;break;case u:i=m+1,i=i<s.numOfRows?i:s.numOfRows-1,p=v}var g=e(s.$rows[i]),y=e(g.find("td")[p]);s.isShiftDown||(s.$cellA=y),s.set$cellB(y),s.updateSelectedCells()}},l.prototype.keyup=function(t){var s=e(this).data(C);t.which===o&&(s.isShiftDown=!1)};var $=function(t){var s=e(t).find("tr");s.each(function(t){var s=e(this).find("td");s.each(function(s){e(this).data(d,t+","+s)})})};l.prototype.update=function(){var t=e(this.element),s=t.find("tr"),l=t.find("td");this.numOfRows=s.length,this.numOfCols=e(s[0]).find("td").length,this.$rows=s,$(this.element),this.$cellA=e(),this.$cellB=e(),this.isMouseDown=!1,this.isShiftDown=!1,this.selectedCells=[],l.off(".selecTable").on("mousedown.selecTable",this.mousedown).on("mouseenter.selecTable",this.mouseenter).on("mouseup.selecTable",this.mouseup)},l.prototype.init=function(){var t=e(this.element);t.on("keydown.selecTable",this.keydown).on("keyup.selecTable",this.keyup),t.attr("unselectable","on").css({"-moz-user-select":"none","-o-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"}).bind("selectstart",function(){return!1}),t.addClass(p),this.update()},e.fn[m]=function(t,i){return typeof t===n&&(i=t,t=s),this.each(function(){if(e.data(this,"plugin_"+m))switch(i){case"update":e.data(this,"plugin_"+m).update()}else e.data(this,"plugin_"+m,new l(this,t))})}}(jQuery,window);